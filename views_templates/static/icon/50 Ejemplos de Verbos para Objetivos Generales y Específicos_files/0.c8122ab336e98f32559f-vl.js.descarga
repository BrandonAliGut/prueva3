(window.avntsWebpackJsonp=window.avntsWebpackJsonp||[]).push([[0],{169:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"emitDsAuctionEvent",(function(){return j})),n.d(t,"runNewAuctions",(function(){return D})),n.d(t,"runAdiAuctions",(function(){return E}));n(27),n(15);var r=n(0),a=n(22),i=n(6),o=n(21),c=n(40),s=n(9),u=n(26),d=n(49),l=n(176),v=n(173),f=e("Hwg="),b=e(2e3),p=e(600),m=e("Cws="),h=[1,2],g=[2,3],O=function(e,t){e.state.player&&(e.state.player.loopData.auctionNumber=t+1,e.state.player.totalAuctions++)},j=function(e,t,n,r,a,i){var o;if((null===(o=e.config.ds)||void 0===o?void 0:o.auctionEnd)&&(null==i?void 0:i.length)){var c=[1,4,2],s={auctionId:t,startTime:n,endTime:r,isoStartTime:a,bids:i.filter((function(e){return c.includes(e.auctionType)}))};s.stream=e.config.ds.stream||f,e.app.emit("auctionEvent",{name:"dsAuctionEnd",index:e.index,data:s})}},y=function(e){return Object(r.b)(this,void 0,void 0,(function(){var t,n,a,i,c;return Object(r.d)(this,(function(r){return t=e.config.slooper.auctionsOnView,n=t.scroll,a=t.tab,i=t.focus,c=function(t){return Object(o.c)(e,t,{playOnView:n,tabView:a,focusView:i},!0)},[2,Object(o.e)(e,c)]}))}))},A=function(e,t){return Object(r.b)(this,void 0,void 0,(function(){return Object(r.d)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),e&&v.a<e?[4,t]:[3,2];case 1:if(n.sent(),v.a<e)return[2,!1];n.label=2;case 2:return[3,4];case 3:return n.sent(),[3,4];case 4:return[2,!0]}}))}))},S=function(){var e;return{promise:new Promise((function(t){e=t})),resolver:e}},T=function(e,t,n,a,o,c,d,v,f){return Object(r.b)(this,void 0,void 0,(function(){var b,p,m,g,O,j,y,T,w,I,x;return Object(r.d)(this,(function(D){switch(D.label){case 0:return b=[],p=S(),m=p.promise,g=p.resolver,O=S(),j=O.promise,y=O.resolver,T=function(){d&&(null==g||g(void 0))},w=t.map((function(t){var a;t="handler"in t?t:{adSource:t,handler:e.state.selectedPlacement,placement:null===(a=e.state.selectedPlacement)||void 0===a?void 0:a.placement};var i=function(e,t,n,a,i,o,c,d,v){var f;return Object(r.b)(this,void 0,void 0,(function(){var b,p,m,g,O,j,y;return Object(r.d)(this,(function(r){switch(r.label){case 0:b=n.adSource,p=n.handler,m=n.label,g=n.placement,O={auctionType:b.auctionType,status:4,asid:b.tagId,bidder:b.bidder,bids:[],floor:b.floor},r.label=1;case 1:return r.trys.push([1,9,,10]),!(b.auctionType in u.a)||b.logic.needConsent&&2===e.state.consentStatus?(O.status=1,[3,8]):[3,2];case 2:return e.state.adServer.cappingHandler.isReqsMaxed(b.tagId)?(O.status=5,[3,8]):[3,3];case 3:return[4,A(b.logic.delayBy,d)];case 4:return r.sent()?(o.push(b.tagId),0===(null===(f=b.logic.dynamicFloor)||void 0===f?void 0:f.strategy)&&Object(s.e)(b,{retry:i}),function(e,t,n,r){if(e.config.sendRequestEvent){var a=function(e,t,n,r){var a=t.bidder,i=t.tagId,o=t.auctionType,c=t.businessModel,s=t.demandOwner,u=t.floor,d={demandOwner:s,label:r,aid:t.aid,bidder:a,auctionId:n,adSourceId:i,auctionType:o,dfStrategy:u.dfStrategy,floorPrice:u.effective,imaginaryFloor:u.imaginary,initialFloor:u.initial,businessModel:c},l=e.state.adServer.dynamicFloor.v3;return l&&t.logic.dynamicFloor&&(u.dfExtraData.imps=l.impsCounter,u.dfExtraData.errors=l.adErrorCounter),d.dfExtraData=u.dfExtraData,d}(e,t,n,r);e.app.emit("auctionEvent",{name:"request",data:a,index:e.index})}}(e,b,a,m),e.state.adServer.cappingHandler.incReqs(b.tagId),[4,u.a[b.auctionType].requestBid(e,b,{retry:i,auctionId:a,handler:p,placement:g,label:m})]):[2];case 5:return(j=r.sent())?(O.status=2,[4,Object(l.a)(e,j,a,b,O,{label:m,placement:g,loopsCounter:v})]):[3,7];case 6:return r.sent(),[3,8];case 7:b.logic.dynamicFloor&&h.includes(b.logic.dynamicFloor.strategy)&&Object(s.e)(b,{gotBid:!1}),r.label=8;case 8:return[3,10];case 9:return y=r.sent(),e.app.logger.error("requestBid Error asid="+b.tagId+", info="+y.message),O.status=6,[3,10];case 10:return t.push(O),3===O.status&&c(),[2]}}))}))}(e,b,t,n,o,c,T,j,f);return t.adSource.logic.delayBy?void 0:i})),I=[Object(i.c)(a),Promise.all(w)],v&&v<=a&&(x=function(e,t){return new Promise((function(n){setTimeout((function(){e.find((function(e){return 3===e.status}))&&n(void 0)}),t)}))}(b,v),I.push(x)),d&&I.push(m),[4,Promise.race(I)];case 1:return D.sent(),null==y||y(void 0),[2,b]}}))}))},w=function(e,t,n){if(e.firstAuctionTimeout&&1===n)return e.firstAuctionTimeout;var r=t.map((function(e){return"handler"in e?e.adSource.timeout:e.timeout}));return Math.max.apply(null,r)},I=function(e,t,n,i,o){var c,u;return void 0===o&&(o={}),Object(r.b)(this,void 0,void 0,(function(){var l,v,f,b,p,m,h,O,y,A,S;return Object(r.d)(this,(function(r){switch(r.label){case 0:return"completed"===e.state.status?[2]:(l=Object(a.a)(),v=e.config.slooper.duringAuctionTimeout,f=o.auctionTimeout||w(i,t,null===(c=e.state.player)||void 0===c?void 0:c.totalAuctions),b=Date.now(),p=(new Date).toISOString(),e.app.logger.debug("auction manager: start ",b),m=function(e,t,n){var r,a;return(null===(r=e.config.stackOptimization)||void 0===r?void 0:r.enable)?1!==n&&1!==(null===(a=e.state.player)||void 0===a?void 0:a.totalAuctions)&&t.firstBidAuction:t.firstBidAuction}(e,i,o.auctionLogic),[4,T(e,t,l,f,n,h=[],m,v,o.loopsCounter)]);case 1:return O=r.sent(),y=Date.now(),e.app.logger.debug("auction manager: end ["+(y-b)+"]",y),A=function(e){var t={responsesCount:0,bidders:[]};return(null==e?void 0:e.length)&&(t=e.reduce((function(e,t){return g.includes(t.status)&&e.responsesCount++,e.bidders.push(t.asid),e}),t)),t}(O),function(e,t,n,r,a,i,o){var c=t.responsesCount,s=t.bidders;e.app.emit("auctionEvent",{name:"auctionEnd",data:{biddersCount:s.length,startTime:r,endTime:a,auctionId:n,responsesCount:c,auctionAsid:s.join(","),loopsCounter:o,participatingAsids:i.join(",")},index:e.index})}(e,A,l,b,y,h,o.loopsCounter),j(e,l,b,y,p,O),null===(u=e.state.adServer.stackOptHandler)||void 0===u||u.sort(),e.state.adServer.dynamicFloor.v3&&(S=function(e){return null==e?void 0:e.reduce((function(e,t){return 3===t.status&&(e[t.asid]=t.auctionType),e}),{})}(O),Object(d.a)(e,e.state.adServer.dynamicFloor.v3,S)),e.state.adServer.dynamicFloor.sessionFloorsEnabled&&Object(s.f)(e),[2,A]}}))}))},x=function(e,t){return Object(r.b)(this,void 0,void 0,(function(){var n,a;return Object(r.d)(this,(function(r){switch(r.label){case 0:!function(e){e.state.player&&(e.state.player.loopData.auctionNumber=0)}(e),n=0,r.label=1;case 1:return n<e.config.maxAdRetries?e.config.slooper.auctionsOnView.enable?[4,y(e)]:[3,3]:[3,7];case 2:r.sent(),r.label=3;case 3:return O(e,n),[4,I(e,e.state.adServer.adSources,n,e.config.slooper,t)];case 4:return(null==(a=r.sent())?void 0:a.responsesCount)?[3,7]:n<e.config.maxAdRetries-1?[4,Object(i.c)(p)]:[3,6];case 5:r.sent(),r.label=6;case 6:return n++,[3,1];case 7:return[2]}}))}))},D=function(e,t){return Object(r.b)(this,void 0,void 0,(function(){var n;return Object(r.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),"completed"===e.state.status?[2]:[4,x(e,t)];case 1:return[2,r.sent()];case 2:return n=r.sent(),e.app.logger.error("auction failed: "+(null==n?void 0:n.message)),[3,3];case 3:return[2]}}))}))},C=function(e,t){return Object(r.b)(this,void 0,void 0,(function(){return Object(r.d)(this,(function(n){return e-=t+b,[2,Object(i.c)(e)]}))}))},E=function(e,t){return Object(r.b)(this,void 0,void 0,(function(){var n,a;return Object(r.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),"completed"===e.state.status?[2]:(n=w(e.config.slooper,e.state.adServer.adSources),[4,C(t,n)]);case 1:return r.sent(),[4,x(e,{auctionTimeout:n,auctionLogic:1})];case 2:return[2,r.sent()];case 3:return a=r.sent(),e.app.logger.error("auction failed: "+(null==a?void 0:a.message)),[3,4];case 4:return[2]}}))}))},P=function(e,t,n,a,o,c){return Object(r.b)(this,void 0,void 0,(function(){var s,u;return Object(r.d)(this,(function(r){switch(r.label){case 0:s=0,r.label=1;case 1:return s<a?c()?(O(e,s),[4,I(e,t,s,n)]):[2]:[3,5];case 2:return(null==(u=r.sent())?void 0:u.responsesCount)?[2]:s<a-1?[4,Object(i.c)(o)]:[3,4];case 3:r.sent(),r.label=4;case 4:return s++,[3,1];case 5:return[2]}}))}))};t.default=function(e,t){var n=this;void 0===t&&(t={}),c.b["*"]=!1;var a=Object(u.h)(e);return Object(v.b)(),a.catch((function(){})),function(o,s){return Object(r.b)(n,void 0,void 0,(function(){var n,d,l,v,f;return Object(r.d)(this,(function(b){switch(b.label){case 0:return b.trys.push([0,7,,8]),"aniview"!==o.config.playerProvider?[3,4]:s?[4,s()]:[3,2];case 1:return d=b.sent(),[3,3];case 2:d={},b.label=3;case 3:return[2,d];case 4:return[4,a];case 5:return b.sent(),[4,Object(u.e)(o,e.stackOptimization,t[o.config.avChannelId])];case 6:return n=b.sent(),o.state.PlacementAuctionsHandler=function(e,t){if(!(null==t?void 0:t.enable))return{stop:function(){},postView:function(){}};e.app.emit("auctionEvent",{index:e.index,data:{},name:"placementsAuctionLoaded"});var n=[],a=!0,o=t.slooper.loops||0,s=!1,u=function(){n.length>0&&!s&&(s=!0,v())},d=function(){a=!1},l=function(){return a&&!e.state.playerMiddlewareStarted},v=function(){return Object(r.b)(this,void 0,void 0,(function(){return Object(r.d)(this,(function(r){switch(r.label){case 0:return l()&&o>0?[4,P(e,n,t.slooper,t.maxAdRetries,200,l)]:[3,3];case 1:return r.sent(),[4,Object(i.c)(t.slooper.timeout)];case 2:return r.sent(),o--,[3,0];case 3:return d(),[2]}}))}))};return function(){Object(r.b)(this,void 0,void 0,(function(){return Object(r.d)(this,(function(r){return t.preAuctions?(n=e.state.adServer.adSources.filter((function(e){return e.logic.placementAuction.preView})),u(),[2]):[2]}))}))}(),{stop:d,postView:function(r,a,i){var o=a.getAttribute(m);if(c.b[e.index][o]=!1,t.postAuctions){var d=e.state.adServer.adSources.filter((function(e){return e.logic.placementAuction.postView})).map((function(e){return{adSource:e,placement:a,handler:r,label:i}}));n=n.concat(d),s?I(e,d,0,t.slooper):u()}}}}(o,o.config.placement),n.start(),[3,8];case 7:return[2,{error:"auction manager error: "+(null==(l=b.sent())?void 0:l.message)}];case 8:return b.trys.push([8,,12,13]),s?[4,s()]:[3,10];case 9:return v=b.sent(),[3,11];case 10:v={},b.label=11;case 11:return[2,v];case 12:return Object(u.c)(o),null===(f=o.state.PlacementAuctionsHandler)||void 0===f||f.stop(),null==n||n.end(),[7];case 13:return[2]}}))}))}}}.call(this,n(4))},173:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"d",(function(){return s})),n.d(t,"c",(function(){return l})),n.d(t,"b",(function(){return v}));n(27);var r,a,i=n(26),o=n(40),c=0,s=function(e,t,n,i){3===i?e.state.adServer.stackOptHandler?e.state.adServer.stackOptHandler.push(t):r.push(t):2===i&&a.push({bid:t,getAdSourceFloor:function(){return n.floor.effective}}),c++},u=function(e,t){return e.rating-t.rating},d=function(e){e.sort(u)},l=function(e){if(e.state.adServer.stackOptHandler||r.length){var t=e.state.selectedPlacement.label;a.length&&function(e){var t=[];a.forEach((function(n){try{var a=n.getAdSourceFloor(),i=n.bid;i.baseCpm>=a?(i.dfExtraData&&(i.dfExtraData.floorAtPush=a),r.push(i),e.app.logger.debug("Auction Type: "+i.auctionType+", Bidder: "+i.bidder+". Invalid Bid Restored")):t.push(n)}catch(t){e.app.logger.debug("Redundant bid discarded. error:"+t)}})),a=t}(e);var n=function(e){return r.reduce((function(t,n){return n.label?n.label===e?t.currentPlayerBids.push(n):t.bidsToIgnore.push(n):t.sharedBids.push(n),t}),{currentPlayerBids:[],sharedBids:[],bidsToIgnore:[]})}(t),s=function(e,t){var n,r=Math.min(Object.keys(o.a).length,e.sharedBids.length)-(o.a[t]||0);r>0&&(d(e.sharedBids),(n=e.bidsToIgnore).push.apply(n,e.sharedBids.splice(-r)));var a=e.sharedBids.concat(e.currentPlayerBids);return d(a),a}(n,e.index),u=function(e,t){for(var n=e.pop(),r=Date.now();n&&(Object(i.f)(t,n.adSourceId)||void 0!==n.bidExpiredTime&&n.bidExpiredTime<r);)n=e.pop();return n}(e.state.adServer.stackOptHandler||s,e);return e.state.adServer.stackOptHandler||(r=n.bidsToIgnore.concat(s),delete o.a[e.index]),u&&c--,u}},v=function(){r=[],a=[]}},176:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return p}));n(15);var r=n(0),a=n(3),i=n(24),o=n(46),c=n(40),s=n(58),u=n(9),d=n(177),l=n(173),v=e("Cws="),f=function(e,t,n,o,c){var s,u;return Object(r.b)(this,void 0,void 0,(function(){var l,v,f,b,p,m,h,g,O,j,y,A,S,T,w,I,x,D,C,E,P,B,F,k,M,H,R,V,q,z,U,X,_,L,N,J,W;return Object(r.d)(this,(function(G){switch(G.label){case 0:return l=n.ttl,v=n.responseTime,f=n.vastUrl,b=n.creativeId,p=n.appnexus,m=n.adResponse,h=n.renderedAd,g=n.amznp,O=n.bidCode,j=n.nurl,y=n.isAmznDebug,A=o.bidder,S=o.tagId,T=o.auctionType,w=o.logic,I=o.businessModel,x=o.cutModel,D=o.demandOwner,C=o.aid,E=o.bidExtraData,P=null!==(s=c.label)&&void 0!==s?s:w.relatedPlacement?null===(u=e.state.selectedPlacement)||void 0===u?void 0:u.label:void 0,B=function(e){var t=Object(a.a)(e);return void 0!==t?Date.now()+1e3*t:void 0}(l),[4,Object(d.a)(e,n,o)];case 1:return F=G.sent(),k=F.vastData,M=F.vastAdData,H=F.vasts,R=F.vastXml,V=function(e,t,n){var r=t.cutModel,o=t.businessModel,c=t.pgr,s=e.cpm||Object(a.a)(Object(i.b)(n[0],"(?:price|pricing)",!0,"i"))||t.cpm||t.floor.effective,u=Math.max(0,2===r.model?s*(1-r.value):s-r.value);return{baseCpm:s,cpm:u,pCpm:2===o.model?o.value*(c||u):o.value}}(n,o,H),q=V.baseCpm,z=V.cpm,U=V.pCpm,X=function(e,t,n,r){var a=e.duration||t.avgDuration&&t.avgDuration/1e3||21;switch(t.bidPriority){case 2:return r;case 1:return n-r;case 3:return n/a;default:return n}}(M,w,z,U),_=o.floor,L=_.effective,N=_.imaginary,J=_.dfStrategy,W=_.initial,[2,Object(r.a)(Object(r.a)({demandOwner:D,label:P,aid:C,dfStrategy:J,insertTime:Date.now(),bidExtraData:E,baseCpm:q,prebidExtraData:Object(r.a)(Object(r.a)(Object(r.a)({},p),null==m?void 0:m.ad),{ad_profile_id:null==m?void 0:m.ad_profile_id,creativeId:b}),imaginaryFloor:N,bidExpiredTime:B,vastUrl:f,ttl:l,cpm:z,bidder:A,responseTime:v,auctionId:t,vastXml:R,adSourceId:S,auctionType:T,initialFloor:W,floorPrice:L},M),{businessModel:I,cutModel:x,pCpm:U,rating:X,vasts:H,renderedAd:h,amznp:g,bidCode:O,vastData:k,isAmznDebug:y,nurl:j,adServerAsid:n.adSourceId,adInIframe:w.adInIframe,loopsCounter:c.loopsCounter})]}}))}))},b=function(e,t,n,a,i){var s;return Object(r.b)(this,void 0,void 0,(function(){var d,b,p;return Object(r.d)(this,(function(r){switch(r.label){case 0:return[4,f(e,t,n,a,i)];case 1:return d=r.sent(),b=function(e,t){var n;if(6===t.auctionType)return 3;var r=e.vastUrl,a=e.vastXml,i=e.baseCpm;return r&&!a||o.c(a)?i>=e.floorPrice?3:(null===(n=t.logic.dynamicFloor)||void 0===n?void 0:n.storeInvalidBids)?2:1:1}(d,a),p=3===b,2===(null===(s=a.logic.dynamicFloor)||void 0===s?void 0:s.strategy)&&Object(u.e)(a,{cpm:d.cpm,gotBid:p}),d.dfExtraData=a.floor.dfExtraData,e.app.emit("auctionEvent",{name:"bid",data:d,index:e.index}),Object(l.d)(e,d,a,b),p?(function(e,t){var n,r;if(t){var a=t.getAttribute(v);null!==a&&(c.b[e][a]=!0,null===(r=null===(n=c.c[e])||void 0===n?void 0:n[a])||void 0===r||r.call(n))}else{c.b["*"]=!0;var i=c.c["*"].values().next().value;null==i||i()}}(e.index,i.placement),[2,d]):[2]}}))}))},p=function(e,t,n,a,i,o){return Object(r.b)(this,void 0,void 0,(function(){var c;return Object(r.d)(this,(function(r){switch(r.label){case 0:return(c=Array.isArray(t)?t:[t]).length?[4,Object(s.a)(c.map((function(t){return b(e,n,t,a,o)})))]:[3,2];case 1:r.sent().filter((function(t){return"fulfilled"===t.status&&t.value?(i.bids.push(t.value.cpm),i.status=3,!0):(t.reason&&e.app.logger.error("bidBuilder Error asid="+a.tagId+", info="+t.reason),!1)})),r.label=2;case 2:return[2]}}))}))}}).call(this,n(4))},177:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f}));var r=n(0),a=n(3),i=n(6),o=n(24),c=n(2),s=n(46),u=e(5),d=function(e,t){var n;return Object(r.b)(this,void 0,void 0,(function(){return Object(r.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,s.d(e,t)];case 1:return[2,null===(n=r.sent())||void 0===n?void 0:n.text()];case 2:return r.sent(),[3,3];case 3:return[2]}}))}))},l=function(e){if(!e.length)return{video:{}};var t=function(e){for(var t=[],n=[],r=e.length-1;r>=0;r--){var a=e[r];t.push(Object(o.b)(a,"AdSystem",!0,"i")||"");var i=Object(o.a)(a,"Ad","id");n.push(Object(c.m)(a,i))}return{adSystem:t[0],adSystems:t.join(","),mediaType:n[0],mediaTypes:n.join(",")}}(e),n=t.adSystem,r=t.adSystems,s=t.mediaType,u=t.mediaTypes,d=e[e.length-1],l=function(e){var t=Object(o.b)(e,"Duration",!0,"i"),n=t?Object(i.d)(t):void 0;return n?Object(a.a)(n.getTime()/1e3):void 0}(d),v=function(e){return{src:Object(o.b)(e,"MediaFile",!0,"i"),clickThrough:Object(o.b)(e,"ClickThrough",!0,"i"),adId:Object(o.a)(e,"Ad","id","i"),creativeId:Object(o.a)(e,"Creative","id","i")}}(d);return{video:{src:v.src,duration:l},adSystems:r,adSystem:n,duration:l,clickThrough:v.clickThrough,adId:v.adId,creativeId:v.creativeId,mediaType:s,mediaTypes:u}},v=function(e,t,n){return Object(r.b)(this,void 0,void 0,(function(){var a,i,c,s;return Object(r.d)(this,(function(r){switch(r.label){case 0:if(a=[e],!n)return[3,4];i=Object(o.b)(e,"VASTAdTagURI",!0,"i"),c=0,r.label=1;case 1:return c<u&&i?[4,d(i,t)]:[3,4];case 2:if(!(s=r.sent()))return[3,4];a.push(s),i=Object(o.b)(s,"VASTAdTagURI",!0,"i"),r.label=3;case 3:return c++,[3,1];case 4:return[2,a]}}))}))},f=function(e,t,n){var a=n.timeout,i=n.logic.deepDive;return Object(r.b)(this,void 0,void 0,(function(){var n,o,c,s,u;return Object(r.d)(this,(function(r){switch(r.label){case 0:return n=t.vastUrl,o=t.renderedAd,c=t.vastXml,u=[],"function"!=typeof(null==o?void 0:o.getAdParams)?[3,1]:(s=o.getAdParams(),[3,6]);case 1:return!n||c?[3,3]:[4,d(n,a)];case 2:c=r.sent(),r.label=3;case 3:return c?[4,v(c,a,i)]:[3,5];case 4:u=r.sent(),r.label=5;case 5:s=l(u),r.label=6;case 6:return[2,{vastData:function(e,t,n){var r=e.config.bidExtraData||{},a=r.enabled,i=r.startTime,o=r.duration;if(a&&o&&i){var c=Date.now();if(c>i&&c<=i+60*o*60*1e3)return n||t}}(e,n,c),vastAdData:s,vasts:u,vastXml:c}]}}))}))}}).call(this,n(4))}}]);